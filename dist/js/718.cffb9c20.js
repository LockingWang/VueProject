"use strict";(self["webpackChunkvue_project"]=self["webpackChunkvue_project"]||[]).push([[718],{7718:function(t,e,s){s.r(e),s.d(e,{default:function(){return yt}});var a=s(3396),l=s(7139);const o={class:"text-end mt-3 pe-5"},i={class:"overflow-auto"},n={class:"table mt-4"},c=(0,a._)("thead",{class:"text-nowrap"},[(0,a._)("tr",null,[(0,a._)("th",{width:"120"},"分類"),(0,a._)("th",null,"產品名稱"),(0,a._)("th",{width:"120"},"原價"),(0,a._)("th",{width:"120"},"售價"),(0,a._)("th",{width:"100"},"是否啟用"),(0,a._)("th",{width:"200"},"編輯")])],-1),d={class:"text-right"},r={class:"text-right"},p={key:0,class:"text-success"},u={key:1,class:"text-muted"},m={class:"btn-group"},h=["onClick"],g=["onClick"];function _(t,e,s,_,b,f){const w=(0,a.up)("LoadingOverlay"),v=(0,a.up)("PaginationModel"),y=(0,a.up)("ProductModal"),P=(0,a.up)("DelModal");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(w,{active:b.isLoading},null,8,["active"]),(0,a._)("div",o,[(0,a._)("button",{type:"button",class:"btn btn-primary",onClick:e[0]||(e[0]=t=>f.openModal(!0))},"新增產品")]),(0,a._)("div",i,[(0,a._)("table",n,[c,(0,a._)("tbody",null,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(b.products,(e=>((0,a.wg)(),(0,a.iD)("tr",{key:e.id},[(0,a._)("td",null,(0,l.zw)(e.category),1),(0,a._)("td",null,(0,l.zw)(e.title),1),(0,a._)("td",d,(0,l.zw)(t.$filters.currency(e.origin_price)),1),(0,a._)("td",r,(0,l.zw)(t.$filters.currency(e.price)),1),(0,a._)("td",null,[e.is_enabled?((0,a.wg)(),(0,a.iD)("span",p,"啟用")):((0,a.wg)(),(0,a.iD)("span",u,"未啟用"))]),(0,a._)("td",null,[(0,a._)("div",m,[(0,a._)("button",{class:"btn btn-outline-primary btn-sm text-nowrap",onClick:t=>f.openModal(!1,e)},"編輯",8,h),(0,a._)("button",{class:"btn btn-outline-danger btn-sm text-nowrap",onClick:t=>f.openDelModal(e)},"刪除",8,g)])])])))),128))])])]),(0,a.Wm)(v,{pages:b.pagination,onEmitPages:f.getProducts},null,8,["pages","onEmitPages"]),(0,a.Wm)(y,{ref:"productModal",product:b.tempProduct,onUpdateProduct:f.updateProduct},null,8,["product","onUpdateProduct"]),(0,a.Wm)(P,{ref:"delModal",item:b.delItem,onDelItem:f.deleteProduct},null,8,["item","onDelItem"])],64)}var b=s(9242);const f={class:"modal fade",ref:"modal"},w={class:"modal-dialog modal-xl",role:"document"},v={class:"modal-content border-0"},y=(0,a._)("div",{class:"modal-header bg-danger text-white"},[(0,a._)("h5",{class:"modal-title",id:"exampleModalLabel"},[(0,a._)("span",null,"新增產品")]),(0,a._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),P={class:"modal-body"},M={class:"row"},U={class:"col-sm-4"},x=(0,a._)("h5",null,"商品封面",-1),k={class:"mb-3"},$=["src"],L={class:"form-label w-100",for:"img-url"},D={class:"mb-3"},C={for:"customFile",class:"form-label w-100"},S=(0,a._)("i",{class:"fas fa-spinner fa-spin"},null,-1),I={class:"my-3"},F=(0,a._)("h5",null,"商品參考圖",-1),V={class:"input-group mb-3"},O={class:"input-group mb-3"},j={type:"file",class:"form-control","aria-label":"imageFile",ref:"otherFile"},W={class:"row g-2 justify-content-center"},Z=["src"],z=["onClick"],H=(0,a._)("i",{class:"bi bi-x"},null,-1),N=[H],Y={class:"col-sm-8"},B={class:"my-3"},E={for:"title",class:"form-label w-100"},K={class:"row gx-2"},T={class:"mb-3 col-md-6"},q={for:"category",class:"form-label w-100"},A={class:"mb-3 col-md-6"},G={for:"price",class:"form-label w-100"},J={class:"row gx-2"},Q={class:"mb-3 col-md-6"},R={for:"origin_price",class:"form-label w-100"},X={class:"mb-3 col-md-6"},tt={for:"price",class:"form-label w-100"},et=(0,a._)("hr",null,null,-1),st={class:"mb-3"},at={for:"description",class:"form-label w-100"},lt={class:"mb-3"},ot={for:"content",class:"form-label w-100"},it={class:"mb-3"},nt={class:"form-check"},ct={class:"form-check-label",for:"is_enabled"},dt={class:"modal-footer"},rt=(0,a._)("button",{type:"button",class:"btn btn-lg btn-outline-secondary d-block","data-bs-dismiss":"modal"},"取消 ",-1);function pt(t,e,s,l,o,i){const n=(0,a.up)("LoadingOverlay");return(0,a.wg)(),(0,a.iD)("div",f,[(0,a.Wm)(n,{active:o.isLoading},null,8,["active"]),(0,a._)("div",w,[(0,a._)("div",v,[y,(0,a._)("div",P,[(0,a._)("div",M,[(0,a._)("div",U,[x,(0,a._)("div",k,[(0,a._)("img",{class:"img-fluid",alt:"",src:o.tempProduct.imageUrl},null,8,$)]),(0,a._)("div",null,[(0,a._)("label",L,[(0,a.Uk)("圖片網址 : "),(0,a.wy)((0,a._)("input",{class:"form-control",type:"text",id:"img-url","onUpdate:modelValue":e[0]||(e[0]=t=>o.tempProduct.imageUrl=t)},null,512),[[b.nr,o.tempProduct.imageUrl]])])]),(0,a._)("div",D,[(0,a._)("label",C,[S,(0,a._)("input",{type:"file",id:"customFile",class:"form-control",ref:"mainFile",onChange:e[1]||(e[1]=t=>i.uploadFile())},null,544)])]),(0,a._)("div",I,[F,(0,a._)("div",V,[(0,a.wy)((0,a._)("input",{type:"text",class:"form-control",placeholder:"請輸入圖片網址","aria-label":"imageUrl","onUpdate:modelValue":e[2]||(e[2]=t=>o.tempImagesUrl=t)},null,512),[[b.nr,o.tempImagesUrl]]),(0,a._)("button",{class:"btn btn-outline-secondary",type:"button",id:"button-addon2",onClick:e[3]||(e[3]=t=>i.uploadOthers("url"))},"新增參考圖")]),(0,a._)("div",O,[(0,a._)("input",j,null,512),(0,a._)("button",{class:"btn btn-outline-secondary",type:"button",onClick:e[4]||(e[4]=t=>i.uploadOthers("file"))},"上傳參考圖")]),(0,a._)("div",W,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(o.tempProduct.imagesUrl,((t,e)=>((0,a.wg)(),(0,a.iD)("div",{class:"col-6 col-lg-4 position-relative",key:t},[(0,a._)("img",{class:"img-fluid",src:t,alt:""},null,8,Z),(0,a._)("button",{type:"button",class:"btn btn-danger position-absolute p-0 img-del-btn",onClick:t=>i.delImages(e)},N,8,z)])))),128))])])]),(0,a._)("div",Y,[(0,a._)("div",B,[(0,a._)("label",E,[(0,a.Uk)("標題 (Title) "),(0,a.wy)((0,a._)("input",{type:"text",class:"form-control",id:"title",placeholder:"請輸入標題","onUpdate:modelValue":e[5]||(e[5]=t=>o.tempProduct.title=t)},null,512),[[b.nr,o.tempProduct.title]])])]),(0,a._)("div",K,[(0,a._)("div",T,[(0,a._)("label",q,[(0,a.Uk)("分類 (Category) "),(0,a.wy)((0,a._)("input",{type:"text",class:"form-control",id:"category",placeholder:"請輸入分類","onUpdate:modelValue":e[6]||(e[6]=t=>o.tempProduct.category=t)},null,512),[[b.nr,o.tempProduct.category]])])]),(0,a._)("div",A,[(0,a._)("label",G,[(0,a.Uk)("單位 (Unit) "),(0,a.wy)((0,a._)("input",{type:"text",class:"form-control",id:"unit",placeholder:"請輸入單位","onUpdate:modelValue":e[7]||(e[7]=t=>o.tempProduct.unit=t)},null,512),[[b.nr,o.tempProduct.unit]])])])]),(0,a._)("div",J,[(0,a._)("div",Q,[(0,a._)("label",R,[(0,a.Uk)("原價 (Origin Price) "),(0,a.wy)((0,a._)("input",{type:"number",class:"form-control",id:"origin_price",placeholder:"請輸入原價","onUpdate:modelValue":e[8]||(e[8]=t=>o.tempProduct.origin_price=t)},null,512),[[b.nr,o.tempProduct.origin_price]])])]),(0,a._)("div",X,[(0,a._)("label",tt,[(0,a.Uk)("售價 (Price) "),(0,a.wy)((0,a._)("input",{type:"number",class:"form-control",id:"price",placeholder:"請輸入售價","onUpdate:modelValue":e[9]||(e[9]=t=>o.tempProduct.price=t)},null,512),[[b.nr,o.tempProduct.price]])])])]),et,(0,a._)("div",st,[(0,a._)("label",at,[(0,a.Uk)("產品描述 "),(0,a.wy)((0,a._)("textarea",{type:"text",class:"form-control",id:"description",placeholder:"請輸入產品描述","onUpdate:modelValue":e[10]||(e[10]=t=>o.tempProduct.description=t)},null,512),[[b.nr,o.tempProduct.description]])])]),(0,a._)("div",lt,[(0,a._)("label",ot,[(0,a.Uk)("說明內容 "),(0,a.wy)((0,a._)("textarea",{type:"text",class:"form-control",id:"content",placeholder:"請輸入產品說明內容","onUpdate:modelValue":e[11]||(e[11]=t=>o.tempProduct.content=t)},null,512),[[b.nr,o.tempProduct.content]])])]),(0,a._)("div",it,[(0,a._)("div",nt,[(0,a._)("label",ct,[(0,a.wy)((0,a._)("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,id:"is_enabled","onUpdate:modelValue":e[12]||(e[12]=t=>o.tempProduct.is_enabled=t)},null,512),[[b.e8,o.tempProduct.is_enabled]]),(0,a.Uk)(" 是否啟用 ")])])])])])]),(0,a._)("div",dt,[rt,(0,a._)("button",{type:"button",class:"btn btn-lg btn-danger w-50",onClick:e[13]||(e[13]=e=>t.$emit("update-product",o.tempProduct))},"確認")])])])],512)}s(7658);var ut=s(1339),mt={props:{product:{type:Object,default(){return{}}}},watch:{product(){this.tempProduct=this.product}},data(){return{modal:{},tempProduct:{},tempImagesUrl:"",isLoading:!1}},methods:{uploadFile(){const t=this.$refs.mainFile.files[0],e=new FormData;e.append("file-to-upload",t),this.isLoading=!0;const s="https://vue3-course-api.hexschool.io/api/cong-ren/admin/upload";this.$http.post(s,e).then((t=>{this.isLoading=!1,t.data.success?(this.tempProduct.imageUrl=t.data.imageUrl,this.$httpMessageState("success","主商品圖上傳成功","新增參考圖，可以提升消費者的購買意願喔 !")):this.$httpMessageState("warning","主商品圖上傳失敗","檔案必須小於 1MB 且為圖片格式")})).catch((()=>{this.isLoading=!1,this.$httpMessageState("danger","發生錯誤","請洽工程師。")}))},uploadOthers(t){if(this.tempProduct.imagesUrl.length>=5)this.$httpMessageState("warning","參考圖數量限制","商品參考圖最多5張，請刪除先刪除不要的圖片。");else if("url"===t)this.tempProduct.imagesUrl.push(this.tempImagesUrl);else{const t=this.$refs.otherFile.files[0],e=new FormData;e.append("file-to-upload",t);const s="https://vue3-course-api.hexschool.io/api/cong-ren/admin/upload";this.isLoading=!0,this.$http.post(s,e).then((t=>{this.isLoading=!1,t.data.success?(this.tempProduct.imagesUrl.push(t.data.imageUrl),this.$httpMessageState("success","上傳參考圖成功","繼續新增完善商品吧 !")):this.$httpMessageState("warning","上傳參考圖失敗","檔案必須小於 1MB 且為圖片格式")})).catch((()=>{this.isLoading=!1,this.$httpMessageState("danger","發生錯誤","請洽工程師。")}))}},delImages(t){this.tempProduct.imagesUrl.splice(t,1)}},mixins:[ut.Z],inject:["$httpMessageState"]},ht=s(89);const gt=(0,ht.Z)(mt,[["render",pt]]);var _t=gt,bt=s(1956),ft=s(5239),wt={data(){return{products:[],pagination:{},tempProduct:{},isNew:!1,delItem:{},isLoading:!1}},components:{ProductModal:_t,DelModal:bt.Z,PaginationModel:ft.Z},inject:["emitter","$httpMessageState"],methods:{getProducts(t=1){let e="";e="previous"===t&&this.pagination.has_pre?this.pagination.current_page-1:"next"===t&&this.pagination.has_next?this.pagination.current_page+1:t;const s=`https://vue3-course-api.hexschool.io/api/cong-ren/admin/products?page=${e}`;this.isLoading=!0,this.$http.get(s).then((t=>{this.isLoading=!1,t.data.success&&(this.products=t.data.products,this.pagination=t.data.pagination)})).catch((t=>{console.log(t.response)}))},openModal(t,e){this.tempProduct=t?{imagesUrl:[]}:{...e},this.isNew=t;const s=this.$refs.productModal;s.showModal()},openDelModal(t){this.delItem=t;const e=this.$refs.delModal;e.showModal()},updateProduct(t){this.tempProduct=t;let e="https://vue3-course-api.hexschool.io/api/cong-ren/admin/product",s="post";this.isNew||(e=`https://vue3-course-api.hexschool.io/api/cong-ren/admin/product/${t.id}`,s="put");const a=this.$refs.productModal;this.isLoading=!0,this.$http[s](e,{data:this.tempProduct}).then((t=>{this.isLoading=!1,t.data.success?(a.hideModal(),this.$httpMessageState("success","更新成功",t.data.message),this.getProducts()):this.$httpMessageState("warning","更新失敗",t.data.message)})).catch((()=>{this.isLoading=!1,this.$httpMessageState("danger","發生錯誤","請洽工程師。")}))},deleteProduct(){const t=`https://vue3-course-api.hexschool.io/api/cong-ren/admin/product/${this.delItem.id}`;this.isLoading=!0,this.$http.delete(t).then((t=>{if(this.isLoading=!1,t.data.success){const e=this.$refs.delModal;e.hideModal(),this.$httpMessageState("success","刪除成功",t.data.message),this.getProducts()}else this.$httpMessageState("warning","刪除失敗",t.data.message)})).catch((()=>{this.isLoading=!1,this.$httpMessageState("danger","發生錯誤","請洽工程師。")}))}},created(){this.getProducts()}};const vt=(0,ht.Z)(wt,[["render",_]]);var yt=vt}}]);
//# sourceMappingURL=718.cffb9c20.js.map