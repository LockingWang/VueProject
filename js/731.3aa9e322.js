"use strict";(self["webpackChunkvue_project"]=self["webpackChunkvue_project"]||[]).push([[731],{3731:function(e,t,s){s.r(t),s.d(t,{default:function(){return ge}});var a=s(3396),l=s(7139);const r={class:"container-fluid"},d={class:"text-end mt-3 pe-5"},i={class:"overflow-auto"},o={class:"table mt-4 text-nowrap"},n=(0,a._)("thead",null,[(0,a._)("tr",null,[(0,a._)("th",null,"訂單編號"),(0,a._)("th",null,"訂單成立時間"),(0,a._)("th",null,"訂購人"),(0,a._)("th",null,"訂單金額"),(0,a._)("th",null,"付款狀態"),(0,a._)("th",null,"編輯")])],-1),c={key:0,class:"text-success"},p={key:1,class:"text-muted"},u={class:"btn-group"},h=["onClick"],m=["onClick"];function g(e,t,s,g,_,b){const w=(0,a.up)("LoadingOverlay"),O=(0,a.up)("PaginationModel"),f=(0,a.up)("OrderModal"),v=(0,a.up)("DelModal");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(w,{active:_.isLoading},null,8,["active"]),(0,a._)("div",r,[(0,a._)("div",d,[(0,a._)("button",{type:"button",class:"btn btn-danger",onClick:t[0]||(t[0]=e=>b.openDelModal("all"))},"刪除全部訂單")]),(0,a._)("div",i,[(0,a._)("table",o,[n,(0,a._)("tbody",null,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(_.orders,(t=>((0,a.wg)(),(0,a.iD)("tr",{key:t.id},[(0,a._)("td",null,(0,l.zw)(t.id),1),(0,a._)("td",null,(0,l.zw)(e.$filters.inputDateType(t.create_at)),1),(0,a._)("td",null,(0,l.zw)(t.user.name),1),(0,a._)("td",null,(0,l.zw)(e.$filters.currency(t.total)),1),(0,a._)("td",null,[t.is_paid?((0,a.wg)(),(0,a.iD)("span",c,"已付款")):((0,a.wg)(),(0,a.iD)("span",p,"未付款"))]),(0,a._)("td",null,[(0,a._)("div",u,[(0,a._)("button",{class:"btn btn-outline-primary btn-sm text-nowrap",onClick:e=>b.openModal(t)},"編輯",8,h),(0,a._)("button",{class:"btn btn-outline-danger btn-sm text-nowrap",onClick:e=>b.openDelModal(t)},"刪除",8,m)])])])))),128))])])]),(0,a.Wm)(O,{pages:_.pagination,onEmitPages:b.getOrders},null,8,["pages","onEmitPages"]),(0,a.Wm)(f,{ref:"orderModal",order:_.tempOrder,onUpdateOrder:b.updateOrder},null,8,["order","onUpdateOrder"]),(0,a.Wm)(v,{ref:"delModal",item:_.delOrder,onDelItem:b.deleteOrder,onDelAll:b.deleteAll},null,8,["item","onDelItem","onDelAll"])])],64)}var _=s(5239),b=s(9242);const w={class:"modal fade",ref:"modal"},O={class:"modal-dialog modal-xl",role:"document"},f={class:"modal-content border-0"},v={class:"modal-header bg-danger text-white"},y={class:"modal-title",id:"exampleModalLabel"},M=(0,a._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),x={class:"modal-body"},k={class:"row gy-3 gy-lg-1"},$={class:"col-lg-4 border-end"},D=(0,a._)("h5",{class:"text-danger"},"訂購人資訊",-1),L={for:"user-name",class:"form-label w-100"},U={for:"user-tel",class:"form-label w-100"},S={for:"user-address",class:"form-label w-100"},z={for:"user-email",class:"form-label w-100"},C={class:"col-lg-8"},V=(0,a._)("h5",{class:"text-danger"},"訂單資訊",-1),j={class:"row"},W={class:"col-lg-6"},Z={for:"order-time",class:"form-label w-100"},A={class:"col-lg-6"},P=(0,a._)("p",null,"付款狀態",-1),T={class:"d-flex"},q={class:"form-check form-switch"},H={class:"form-check-label",for:"order_paid"},Y={key:0,class:"text-success"},E={key:1,class:"text-danger"},I={key:0,class:"text-success"},K={class:"col-lg-12"},N=(0,a._)("p",{class:"mb-0"},"訂單內容",-1),B={class:"overflow-auto border border-3 border-danger rounded mb-3"},F={class:"table text-nowrap"},G=(0,a._)("thead",null,[(0,a._)("tr",null,[(0,a._)("th",null,"商品名稱"),(0,a._)("th",{width:"120px"},"數量")])],-1),J={class:"input-group input-group-sm",style:{width:"120px"}},Q=["onUpdate:modelValue"],R={class:"input-group-text"},X={class:"col-lg-6"},ee=(0,a._)("p",{class:"mb-0"},"買家留言",-1),te={class:"border bg-white rounded p-2 mb-3"},se={class:"col-lg-6"},ae={class:"text-center"},le={class:"modal-footer"},re=(0,a._)("button",{type:"button",class:"btn btn-lg btn-outline-secondary d-block","data-bs-dismiss":"modal"},"取消 ",-1);function de(e,t,s,r,d,i){const o=(0,a.up)("LoadingOverlay");return(0,a.wg)(),(0,a.iD)("div",w,[(0,a.Wm)(o,{active:d.isLoading},null,8,["active"]),(0,a._)("div",O,[(0,a._)("div",f,[(0,a._)("div",v,[(0,a._)("h5",y,[(0,a._)("span",null,"編輯訂單 ( 訂單編號: "+(0,l.zw)(d.tempOrder.id)+" )",1)]),M]),(0,a._)("div",x,[(0,a._)("div",k,[(0,a._)("div",$,[D,(0,a._)("label",L,[(0,a.Uk)("姓名 "),(0,a.wy)((0,a._)("input",{type:"text",class:"form-control",id:"user-name","onUpdate:modelValue":t[0]||(t[0]=e=>d.tempOrder.user.name=e)},null,512),[[b.nr,d.tempOrder.user.name]])]),(0,a._)("label",U,[(0,a.Uk)("電話 "),(0,a.wy)((0,a._)("input",{type:"text",class:"form-control",id:"user-tel","onUpdate:modelValue":t[1]||(t[1]=e=>d.tempOrder.user.tel=e)},null,512),[[b.nr,d.tempOrder.user.tel]])]),(0,a._)("label",S,[(0,a.Uk)("地址 "),(0,a.wy)((0,a._)("input",{type:"text",class:"form-control",id:"user-address","onUpdate:modelValue":t[2]||(t[2]=e=>d.tempOrder.user.address=e)},null,512),[[b.nr,d.tempOrder.user.address]])]),(0,a._)("label",z,[(0,a.Uk)("電子信箱 "),(0,a.wy)((0,a._)("input",{type:"text",class:"form-control",id:"user-email","onUpdate:modelValue":t[3]||(t[3]=e=>d.tempOrder.user.email=e)},null,512),[[b.nr,d.tempOrder.user.email]])])]),(0,a._)("div",C,[V,(0,a._)("div",j,[(0,a._)("div",W,[(0,a._)("label",Z,[(0,a.Uk)("訂單建立時間 "),(0,a.wy)((0,a._)("input",{type:"date",class:"form-control",id:"order-time","onUpdate:modelValue":t[4]||(t[4]=e=>d.tempOrder.create_at=e),disabled:""},null,512),[[b.nr,d.tempOrder.create_at]])])]),(0,a._)("div",A,[P,(0,a._)("div",T,[(0,a._)("div",q,[(0,a._)("label",H,[(0,a.wy)((0,a._)("input",{class:"form-check-input",type:"checkbox",role:"switch",id:"order_paid","aria-checked":"check","onUpdate:modelValue":t[5]||(t[5]=e=>d.tempOrder.is_paid=e)},null,512),[[b.e8,d.tempOrder.is_paid]])])]),(0,a._)("div",null,[(0,a._)("div",null,[d.tempOrder.is_paid?((0,a.wg)(),(0,a.iD)("span",Y,"已付款")):((0,a.wg)(),(0,a.iD)("span",E,"尚未付款"))]),d.tempOrder.paid_date?((0,a.wg)(),(0,a.iD)("span",I," 付款日 "+(0,l.zw)(e.$filters.date(1e3*d.tempOrder.paid_date)),1)):(0,a.kq)("",!0)])])]),(0,a._)("div",K,[N,(0,a._)("div",B,[(0,a._)("table",F,[G,(0,a._)("tbody",null,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(d.tempOrder.products,(e=>((0,a.wg)(),(0,a.iD)("tr",{key:e.id},[(0,a._)("td",null,(0,l.zw)(e.product.title),1),(0,a._)("td",null,[(0,a._)("div",J,[(0,a.wy)((0,a._)("input",{type:"number",class:"form-control","aria-label":"buy number","onUpdate:modelValue":t=>e.qty=t,min:"1",disabled:""},null,8,Q),[[b.nr,e.qty,void 0,{number:!0}]]),(0,a._)("div",R," / "+(0,l.zw)(e.product.unit),1)])])])))),128))])])])]),(0,a._)("div",X,[ee,(0,a._)("div",te,[(0,a._)("p",null,(0,l.zw)(d.tempOrder.message),1)])]),(0,a._)("div",se,[(0,a._)("h5",ae," 總金額 "+(0,l.zw)(e.$filters.currency(d.tempOrder.total))+" NTD ",1)])])])])]),(0,a._)("div",le,[re,(0,a._)("button",{type:"button",class:"btn btn-lg btn-danger w-50",onClick:t[6]||(t[6]=(...e)=>i.emitOrder&&i.emitOrder(...e))},"確認")])])])],512)}var ie=s(1339),oe={props:{order:{type:Object,default(){return{}}}},data(){return{modal:{},tempOrder:{products:{},user:{}},isLoading:!1,is_paid:""}},watch:{order(){this.tempOrder=this.order,this.tempOrder.create_at=this.$filters.inputDateType(this.tempOrder.create_at)}},methods:{emitOrder(){const e=new Date(this.tempOrder.create_at).getTime();this.tempOrder.create_at=e/1e3,this.$emit("update-order",this.tempOrder)}},mixins:[ie.Z],inject:["$httpMessageState"]},ne=s(89);const ce=(0,ne.Z)(oe,[["render",de]]);var pe=ce,ue=s(1956),he={components:{PaginationModel:_.Z,OrderModal:pe,DelModal:ue.Z},data(){return{orders:[],tempOrder:{},delOrder:{},isLoading:!1,pagination:{}}},methods:{getOrders(e=1){let t="";t="previous"===e&&this.pagination.has_pre?this.pagination.current_page-1:"next"===e&&this.pagination.has_next?this.pagination.current_page+1:e;const s=`https://vue3-course-api.hexschool.io/api/cong-ren/admin/orders?page=${t}`;this.isLoading=!0,this.$http.get(s).then((e=>{this.isLoading=!1,e.data.success&&(this.orders=e.data.orders,this.pagination=e.data.pagination)})).catch((e=>{console.log("err",e),this.isLoading=!1}))},openModal(e){this.tempOrder={...e};const t=this.$refs.orderModal;t.showModal()},updateOrder(e){const t=this.$refs.orderModal,s=`https://vue3-course-api.hexschool.io/api/cong-ren/admin/order/${e.id}`;this.isLoading=!0,this.$http.put(s,{data:this.tempOrder}).then((e=>{this.isLoading=!1,e.data.success?(t.hideModal(),this.$httpMessageState("success","更新成功",e.data.message),this.getOrders()):this.$httpMessageState("warning","更新失敗","請重新檢查內容，並再次嘗試。")})).catch((()=>{this.isLoading=!1,this.$httpMessageState("danger","發生錯誤","請洽工程師。")}))},openDelModal(e){"all"===e?this.delOrder={title:"全部訂單"}:(this.delOrder=e,this.delOrder.title=`訂單${e.id}`);const t=this.$refs.delModal;t.showModal()},deleteOrder(){const e=this.$refs.delModal,t=`https://vue3-course-api.hexschool.io/api/cong-ren/admin/order/${this.delOrder.id}`;this.isLoading=!0,this.$http.delete(t).then((t=>{this.isLoading=!1,t.data.success?(this.getOrders(),e.hideModal(),this.$httpMessageState("success","刪除訂單成功",t.data.message)):this.$httpMessageState("warning","刪除訂單失敗",t.data.message)})).catch((()=>{this.isLoading=!1,this.$httpMessageState("danger","發生錯誤","請洽工程師。")}))},deleteAll(){const e="https://vue3-course-api.hexschool.io/api/cong-ren/admin/orders/all",t=this.$refs.delModal;this.$http.delete(e).then((e=>{t.hideModal(),e.data.success?(this.$httpMessageState("success","成功清空訂單","讓我們重新開始吧 !"),this.getOrders()):this.$httpMessageState("warning","刪除全部訂單失敗",e.data.message)})).catch((()=>{t.hideModal(),this.$httpMessageState("danger","發生錯誤","請洽工程師。")}))}},created(){this.getOrders()},inject:["emitter","$httpMessageState"]};const me=(0,ne.Z)(he,[["render",g]]);var ge=me}}]);
//# sourceMappingURL=731.3aa9e322.js.map