"use strict";(self["webpackChunkvue_project"]=self["webpackChunkvue_project"]||[]).push([[635],{6635:function(t,e,o){o.r(e),o.d(e,{default:function(){return Y}});var n=o(3396),s=o(7139);const a={class:"text-end mt-3 pe-5"},l={class:"table mt-4"},i=(0,n._)("thead",null,[(0,n._)("tr",null,[(0,n._)("th",null,"名稱"),(0,n._)("th",null,"折扣百分比(%)"),(0,n._)("th",null,"到期日"),(0,n._)("th",null,"是否啟用"),(0,n._)("th",null,"編輯")])],-1),p={key:0,class:"text-success"},d={key:1,class:"text-muted"},u={class:"btn-group"},c=["onClick"],r=["onClick"];function h(t,e,o,h,m,_){const g=(0,n.up)("LoadingOverlay"),b=(0,n.up)("PaginationModel"),C=(0,n.up)("CouponModal"),f=(0,n.up)("DelModal");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n.Wm)(g,{active:m.isLoading},null,8,["active"]),(0,n._)("div",a,[(0,n._)("button",{type:"button",class:"btn btn-primary",onClick:e[0]||(e[0]=t=>_.openModal(!0))},"新增優惠券")]),(0,n._)("table",l,[i,(0,n._)("tbody",null,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(m.coupons,(e=>((0,n.wg)(),(0,n.iD)("tr",{key:e.id},[(0,n._)("td",null,(0,s.zw)(e.title),1),(0,n._)("td",null,(0,s.zw)(`${e.percent}%`),1),(0,n._)("td",null,(0,s.zw)(t.$filters.inputDateType(e.due_date/1e3)),1),(0,n._)("td",null,[e.is_enabled?((0,n.wg)(),(0,n.iD)("span",p,"啟用")):((0,n.wg)(),(0,n.iD)("span",d,"未啟用"))]),(0,n._)("td",null,[(0,n._)("div",u,[(0,n._)("button",{class:"btn btn-outline-primary btn-sm",onClick:t=>_.openModal(!1,e)},"編輯",8,c),(0,n._)("button",{class:"btn btn-outline-danger btn-sm",onClick:t=>_.openDelModal(e)},"刪除",8,r)])])])))),128))])]),(0,n.Wm)(b,{pages:m.pagination,onEmitPages:_.getCoupons},null,8,["pages","onEmitPages"]),(0,n.Wm)(C,{ref:"couponModal",coupon:m.tempCoupon,onUpdateCoupon:_.updateCoupon},null,8,["coupon","onUpdateCoupon"]),(0,n.Wm)(f,{ref:"delModal",item:m.delItem,onDelItem:_.deleteCoupon},null,8,["item","onDelItem"])],64)}var m=o(9242);const _={class:"modal fade",ref:"modal"},g={class:"modal-dialog modal-sm",role:"document"},b={class:"modal-content border-0",style:{width:"300px"}},C=(0,n._)("div",{class:"modal-header bg-success text-white"},[(0,n._)("h5",{class:"modal-title",id:"exampleModalLabel"},[(0,n._)("span",null,"新增優惠券")]),(0,n._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),f={class:"modal-body"},v={class:"mb-3"},w={for:"title",class:"form-label w-100"},M={class:"mb-3"},y={for:"percent",class:"form-label w-100"},k={class:"mb-3"},$={for:"due_date",class:"form-label w-100"},x={class:"mb-3"},D={for:"code",class:"form-label w-100"},U={class:"mb-3"},L={class:"form-check"},S={class:"form-check-label",for:"is_enabled"},I={class:"modal-footer"},V=(0,n._)("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消 ",-1);function Z(t,e,o,s,a,l){return(0,n.wg)(),(0,n.iD)("div",_,[(0,n._)("div",g,[(0,n._)("div",b,[C,(0,n._)("div",f,[(0,n._)("div",v,[(0,n._)("label",w,[(0,n.Uk)("優惠券名稱 "),(0,n.wy)((0,n._)("input",{type:"text",class:"form-control",id:"title",placeholder:"請輸入名稱","onUpdate:modelValue":e[0]||(e[0]=t=>a.tempCoupon.title=t)},null,512),[[m.nr,a.tempCoupon.title]])])]),(0,n._)("div",M,[(0,n._)("label",y,[(0,n.Uk)("折扣百分比 "),(0,n.wy)((0,n._)("input",{type:"number",class:"form-control",id:"percent",placeholder:"請輸入折扣百分比","onUpdate:modelValue":e[1]||(e[1]=t=>a.tempCoupon.percent=t),min:"1"},null,512),[[m.nr,a.tempCoupon.percent]])])]),(0,n._)("div",k,[(0,n._)("label",$,[(0,n.Uk)("到期日 "),(0,n.wy)((0,n._)("input",{type:"date",class:"form-control",id:"due_date",placeholder:"請輸入到期日","onUpdate:modelValue":e[2]||(e[2]=t=>a.tempCoupon.due_date=t)},null,512),[[m.nr,a.tempCoupon.due_date]])])]),(0,n._)("div",x,[(0,n._)("label",D,[(0,n.Uk)("優惠碼 "),(0,n.wy)((0,n._)("input",{type:"text",class:"form-control",id:"code",placeholder:"請輸入優惠碼","onUpdate:modelValue":e[3]||(e[3]=t=>a.tempCoupon.code=t)},null,512),[[m.nr,a.tempCoupon.code]])])]),(0,n._)("div",U,[(0,n._)("div",L,[(0,n._)("label",S,[(0,n.wy)((0,n._)("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,id:"is_enabled","onUpdate:modelValue":e[4]||(e[4]=t=>a.tempCoupon.is_enabled=t)},null,512),[[m.e8,a.tempCoupon.is_enabled]]),(0,n.Uk)(" 是否啟用 ")])])])]),(0,n._)("div",I,[V,(0,n._)("button",{type:"button",class:"btn btn-primary",onClick:e[5]||(e[5]=(...t)=>l.emitCoupon&&l.emitCoupon(...t))},"確認")])])])],512)}var j=o(1339),P={data(){return{modal:{},tempCoupon:{}}},props:{coupon:{type:Object,default(){return{}}}},watch:{coupon(){this.tempCoupon=this.coupon,this.tempCoupon.due_date=this.$filters.inputDateType(this.tempCoupon.due_date/1e3)}},mixins:[j.Z],methods:{emitCoupon(){const t=new Date(this.tempCoupon.due_date).getTime();this.tempCoupon.due_date=t,this.$emit("update-coupon",this.tempCoupon)}}},W=o(89);const z=(0,W.Z)(P,[["render",Z]]);var N=z,T=o(1956),E=o(5239),H={data(){return{coupons:[],pagination:{},tempCoupon:{},isNew:!1,delItem:{},isLoading:!1}},components:{CouponModal:N,DelModal:T.Z,PaginationModel:E.Z},inject:["emitter","$httpMessageState"],methods:{getCoupons(t=1){let e="";e="previous"===t&&this.pagination.has_pre?this.pagination.current_page-1:"next"===t&&this.pagination.has_next?this.pagination.current_page+1:t;const o=`https://vue3-course-api.hexschool.io/api/cong-ren/admin/coupons?page=${e}`;this.isLoading=!0,this.$http.get(o).then((t=>{this.isLoading=!1,t.data.success&&(this.coupons=t.data.coupons,this.pagination=t.data.pagination)})).catch((t=>{console.log(t.response)}))},openModal(t,e){this.tempCoupon=t?{is_enabled:0}:{...e},this.isNew=t;const o=this.$refs.couponModal;o.showModal()},openDelModal(t){this.delItem=t;const e=this.$refs.delModal;e.showModal()},updateCoupon(t){this.tempCoupon=t;let e="https://vue3-course-api.hexschool.io/api/cong-ren/admin/coupon",o="post";this.isNew||(e=`https://vue3-course-api.hexschool.io/api/cong-ren/admin/coupon/${t.id}`,o="put");const n=this.$refs.couponModal;this.isLoading=!0,this.$http[o](e,{data:this.tempCoupon}).then((t=>{this.isLoading=!1,t.data.success?(n.hideModal(),this.$httpMessageState("success","更新成功",t.data.message),this.getCoupons()):this.$httpMessageState("warning","更新失敗","請再檢查一次。")})).catch((()=>{this.$httpMessageState("danger","發生錯誤","請洽工程師。")}))},deleteCoupon(){const t=`https://vue3-course-api.hexschool.io/api/cong-ren/admin/coupon/${this.delItem.id}`;this.isLoading=!0,this.$http.delete(t).then((t=>{if(this.isLoading=!1,t.data.success){const e=this.$refs.delModal;e.hideModal(),this.getCoupons(),this.$httpMessageState("success","成功刪除優惠券",t.data.message)}else this.$httpMessageState("warning","刪除優惠券失敗",t.data.message)})).catch((()=>{this.$httpMessageState("danger","發生錯誤","請洽工程師。")}))}},created(){this.getCoupons()}};const O=(0,W.Z)(H,[["render",h]]);var Y=O}}]);
//# sourceMappingURL=635.7c21bf2c.js.map