"use strict";(self["webpackChunkvue_project"]=self["webpackChunkvue_project"]||[]).push([[469],{4798:function(e,t,a){a.d(t,{Z:function(){return M}});var s=a(3396),l=a(7139),r=a(9242);const i={class:"modal fade",id:"delModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},d={class:"modal-dialog",role:"document"},n={class:"modal-content border-0"},o={class:"modal-header bg-danger text-white"},c={class:"modal-title"},p=(0,s._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),h={class:"modal-body"},u={class:"text-danger"},g=(0,s._)("br",null,null,-1),m={key:0,class:"mt-3"},_={for:"delPassword"},b={key:0,class:"text-danger mb-0"},f={class:"modal-footer"},O=(0,s._)("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消 ",-1);function w(e,t,a,w,v,y){return(0,s.wg)(),(0,s.iD)("div",i,[(0,s._)("div",d,[(0,s._)("div",n,[(0,s._)("div",o,[(0,s._)("h5",c,[(0,s._)("span",null,"刪除 "+(0,l.zw)(a.item.title),1)]),p]),(0,s._)("div",h,[(0,s.Uk)(" 是否刪除 "),(0,s._)("strong",u,(0,l.zw)(a.item.title),1),(0,s.Uk)(),g,(0,s.Uk)("(刪除後將無法恢復)。 "),"全部訂單"===a.item.title?((0,s.wg)(),(0,s.iD)("div",m,[(0,s._)("label",_,[(0,s.Uk)(" 請輸入 [ delete1314 ] ，確認刪除所有訂單。 "),(0,s.wy)((0,s._)("input",{id:"delPassword",type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>v.delKey=e)},null,512),[[r.nr,v.delKey]]),v.wrongKey?((0,s.wg)(),(0,s.iD)("p",b,"輸入錯誤，請謹慎輸入 !")):(0,s.kq)("",!0)])])):(0,s.kq)("",!0)]),(0,s._)("div",f,[O,(0,s._)("button",{type:"button",class:"btn btn-danger",onClick:t[1]||(t[1]=(...e)=>y.deleteTarget&&y.deleteTarget(...e))},"確認刪除 ")])])])],512)}var v=a(1339),y={props:{item:{}},data(){return{modal:{},delKey:"",wrongKey:!1}},methods:{deleteTarget(){"全部訂單"===this.item.title?"delete1314"===this.delKey?this.$emit("del-all"):this.wrongKey=!0:this.$emit("del-item")}},mixins:[v.Z]},x=a(89);const k=(0,x.Z)(y,[["render",w]]);var M=k},5239:function(e,t,a){a.d(t,{Z:function(){return b}});var s=a(3396),l=a(7139),r=a(9242);const i={"aria-label":"Page navigation example"},d={class:"pagination justify-content-center"},n=(0,s._)("span",{"aria-hidden":"true"},"«",-1),o=[n],c=["onClick"],p=(0,s._)("span",{"aria-hidden":"true"},"»",-1),h=[p];function u(e,t,a,n,p,u){return(0,s.wg)(),(0,s.iD)("nav",i,[(0,s._)("ul",d,[(0,s._)("li",{class:(0,l.C_)(["page-item",{"page-link-disabled":!a.pages.has_pre}])},[(0,s._)("a",{class:"page-link",href:"#","aria-label":"Previous",onClick:t[0]||(t[0]=(0,r.iM)((e=>u.updatePage("previous")),["prevent"]))},o)],2),((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(a.pages.total_pages,(e=>((0,s.wg)(),(0,s.iD)("li",{class:(0,l.C_)(["page-item",{active:e===a.pages.current_page}]),key:e},[(0,s._)("a",{class:"page-link",href:"#",onClick:(0,r.iM)((t=>u.updatePage(e)),["prevent"])},(0,l.zw)(e),9,c)],2)))),128)),(0,s._)("li",{class:(0,l.C_)(["page-item",{"page-link-disabled":!a.pages.has_next}])},[(0,s._)("a",{class:"page-link",href:"#","aria-label":"Next",onClick:t[1]||(t[1]=(0,r.iM)((e=>u.updatePage("next")),["prevent"]))},h)],2)])])}var g={props:["pages"],methods:{updatePage(e){this.$emit("emit-pages",e)}}},m=a(89);const _=(0,m.Z)(g,[["render",u]]);var b=_},5469:function(e,t,a){a.r(t),a.d(t,{default:function(){return Me}});var s=a(3396),l=a(9242),r=a(7139);const i={class:"container-fluid"},d={class:"row g-3 mt-3 justify-content-end"},n={class:"col-sm-4"},o={class:"input-group"},c=(0,s.uE)('<option value="" selected>搜尋條件</option><option value="id" selected>訂單編號</option><option value="name" selected>姓名</option><option value="tel" selected>電話</option><option value="email" selected>Email</option>',5),p=[c],h=["disabled"],u={class:"col-sm-3"},g={class:"overflow-auto"},m={class:"table mt-4 text-nowrap"},_=(0,s._)("thead",null,[(0,s._)("tr",null,[(0,s._)("th",null,"訂單編號"),(0,s._)("th",null,"訂單成立時間"),(0,s._)("th",null,"訂購人"),(0,s._)("th",null,"訂單金額"),(0,s._)("th",null,"付款狀態"),(0,s._)("th",null,"編輯")])],-1),b={key:0},f={key:0,class:"text-success"},O={key:1,class:"text-muted"},w={class:"btn-group w-100"},v=["onClick"],y=["onClick"],x={key:1},k=(0,s._)("tr",null,[(0,s._)("td",{colspan:"6",class:"text-center text-secondary"},"歐歐~ 我們查不到有相關的訂單內 !")],-1),M=[k];function $(e,t,a,c,k,$){const D=(0,s.up)("LoadingOverlay"),T=(0,s.up)("PaginationModel"),C=(0,s.up)("OrderModal"),U=(0,s.up)("DelModal");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s.Wm)(D,{active:k.isLoading},null,8,["active"]),(0,s._)("div",i,[(0,s._)("div",d,[(0,s._)("div",n,[(0,s._)("div",o,[(0,s.wy)((0,s._)("select",{class:"form-select","aria-label":"Category","onUpdate:modelValue":t[0]||(t[0]=e=>k.filter=e),onChange:t[1]||(t[1]=e=>$.filtOrders(1))},p,544),[[l.bM,k.filter]]),(0,s.wy)((0,s._)("input",{type:"text",class:"form-control",placeholder:"搜尋關鍵字","aria-label":"serach text","aria-describedby":"serach order","onUpdate:modelValue":t[2]||(t[2]=e=>k.searchText=e),onChange:t[3]||(t[3]=e=>$.textCheck()),disabled:""===this.filter},null,40,h),[[l.nr,k.searchText]])]),(0,s._)("span",{class:"text-danger d-block text-end mb-3",style:(0,r.j5)({opacity:k.specialText})},"請勿輸入特殊字元",4)]),(0,s._)("div",u,[(0,s._)("button",{type:"button",class:"btn btn-danger w-100",onClick:t[4]||(t[4]=e=>$.openDelModal("all"))},"刪除全部訂單")])]),(0,s._)("div",g,[(0,s._)("table",m,[_,0!==k.filtedOrders.length?((0,s.wg)(),(0,s.iD)("tbody",b,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(k.filtedOrders,(t=>((0,s.wg)(),(0,s.iD)("tr",{key:t.id},[(0,s._)("td",null,(0,r.zw)(t.id),1),(0,s._)("td",null,(0,r.zw)(e.$filters.inputDateType(t.create_at)),1),(0,s._)("td",null,(0,r.zw)(t.user.name),1),(0,s._)("td",null,(0,r.zw)(e.$filters.currency(t.total)),1),(0,s._)("td",null,[t.is_paid?((0,s.wg)(),(0,s.iD)("span",f,"已付款")):((0,s.wg)(),(0,s.iD)("span",O,"未付款"))]),(0,s._)("td",null,[(0,s._)("div",w,[(0,s._)("button",{class:"btn btn-outline-primary btn-sm text-nowrap",onClick:e=>$.openModal(t)},"編輯",8,v),(0,s._)("button",{class:"btn btn-outline-danger btn-sm text-nowrap",onClick:e=>$.openDelModal(t)},"刪除",8,y)])])])))),128))])):((0,s.wg)(),(0,s.iD)("tbody",x,M))])]),(0,s.Wm)(T,{pages:k.pagination,onEmitPages:$.filtOrders},null,8,["pages","onEmitPages"]),(0,s.Wm)(C,{ref:"orderModal",order:k.tempOrder,onUpdateOrder:$.updateOrder},null,8,["order","onUpdateOrder"]),(0,s.Wm)(U,{ref:"delModal",item:k.delOrder,onDelItem:$.deleteOrder,onDelAll:$.deleteAll},null,8,["item","onDelItem","onDelAll"])])],64)}a(7658);var D=a(5239);const T={class:"modal fade",ref:"modal"},C={class:"modal-dialog modal-xl",role:"document"},U={class:"modal-content border-0"},L={class:"modal-header bg-danger text-white"},S={class:"modal-title",id:"exampleModalLabel"},P=(0,s._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),z={class:"modal-body"},V={class:"row gy-3 gy-lg-1"},K={class:"col-lg-4 border-end"},Z=(0,s._)("h5",{class:"text-danger"},"訂購人資訊",-1),j={for:"user-name",class:"form-label w-100"},A={for:"user-tel",class:"form-label w-100"},N={for:"user-address",class:"form-label w-100"},J={for:"user-email",class:"form-label w-100"},q={class:"col-lg-8"},E=(0,s._)("h5",{class:"text-danger"},"訂單資訊",-1),W={class:"row"},H={class:"col-lg-6"},Y={for:"order-time",class:"form-label w-100"},I={class:"col-lg-6"},B=(0,s._)("p",null,"付款狀態",-1),F={class:"d-flex"},G={class:"form-check form-switch"},Q={class:"form-check-label",for:"order_paid"},R={key:0,class:"text-success"},X={key:1,class:"text-danger"},ee={key:0,class:"text-success"},te={class:"col-lg-12"},ae=(0,s._)("p",{class:"mb-0"},"訂單內容",-1),se={class:"overflow-auto border border-3 border-danger rounded mb-3"},le={class:"table text-nowrap"},re=(0,s._)("thead",null,[(0,s._)("tr",null,[(0,s._)("th",null,"商品名稱"),(0,s._)("th",{width:"120px"},"數量")])],-1),ie={class:"input-group input-group-sm",style:{width:"120px"}},de=["onUpdate:modelValue"],ne={class:"input-group-text"},oe={class:"col-lg-6"},ce=(0,s._)("p",{class:"mb-0"},"買家留言",-1),pe={class:"border bg-white rounded p-2 mb-3"},he={class:"col-lg-6"},ue={class:"text-center"},ge={class:"modal-footer"},me=(0,s._)("button",{type:"button",class:"btn btn-lg btn-outline-secondary d-block","data-bs-dismiss":"modal"},"取消 ",-1);function _e(e,t,a,i,d,n){const o=(0,s.up)("LoadingOverlay");return(0,s.wg)(),(0,s.iD)("div",T,[(0,s.Wm)(o,{active:d.isLoading},null,8,["active"]),(0,s._)("div",C,[(0,s._)("div",U,[(0,s._)("div",L,[(0,s._)("h5",S,[(0,s._)("span",null,"編輯訂單 ( 訂單編號: "+(0,r.zw)(d.tempOrder.id)+" )",1)]),P]),(0,s._)("div",z,[(0,s._)("div",V,[(0,s._)("div",K,[Z,(0,s._)("label",j,[(0,s.Uk)("姓名 "),(0,s.wy)((0,s._)("input",{type:"text",class:"form-control",id:"user-name","onUpdate:modelValue":t[0]||(t[0]=e=>d.tempOrder.user.name=e)},null,512),[[l.nr,d.tempOrder.user.name]])]),(0,s._)("label",A,[(0,s.Uk)("電話 "),(0,s.wy)((0,s._)("input",{type:"text",class:"form-control",id:"user-tel","onUpdate:modelValue":t[1]||(t[1]=e=>d.tempOrder.user.tel=e)},null,512),[[l.nr,d.tempOrder.user.tel]])]),(0,s._)("label",N,[(0,s.Uk)("地址 "),(0,s.wy)((0,s._)("input",{type:"text",class:"form-control",id:"user-address","onUpdate:modelValue":t[2]||(t[2]=e=>d.tempOrder.user.address=e)},null,512),[[l.nr,d.tempOrder.user.address]])]),(0,s._)("label",J,[(0,s.Uk)("電子信箱 "),(0,s.wy)((0,s._)("input",{type:"text",class:"form-control",id:"user-email","onUpdate:modelValue":t[3]||(t[3]=e=>d.tempOrder.user.email=e)},null,512),[[l.nr,d.tempOrder.user.email]])])]),(0,s._)("div",q,[E,(0,s._)("div",W,[(0,s._)("div",H,[(0,s._)("label",Y,[(0,s.Uk)("訂單建立時間 "),(0,s.wy)((0,s._)("input",{type:"date",class:"form-control",id:"order-time","onUpdate:modelValue":t[4]||(t[4]=e=>d.tempOrder.create_at=e),disabled:""},null,512),[[l.nr,d.tempOrder.create_at]])])]),(0,s._)("div",I,[B,(0,s._)("div",F,[(0,s._)("div",G,[(0,s._)("label",Q,[(0,s.wy)((0,s._)("input",{class:"form-check-input",type:"checkbox",role:"switch",id:"order_paid","aria-checked":"check","onUpdate:modelValue":t[5]||(t[5]=e=>d.tempOrder.is_paid=e)},null,512),[[l.e8,d.tempOrder.is_paid]])])]),(0,s._)("div",null,[(0,s._)("div",null,[d.tempOrder.is_paid?((0,s.wg)(),(0,s.iD)("span",R,"已付款")):((0,s.wg)(),(0,s.iD)("span",X,"尚未付款"))]),d.tempOrder.paid_date?((0,s.wg)(),(0,s.iD)("span",ee," 付款日 "+(0,r.zw)(e.$filters.date(1e3*d.tempOrder.paid_date)),1)):(0,s.kq)("",!0)])])]),(0,s._)("div",te,[ae,(0,s._)("div",se,[(0,s._)("table",le,[re,(0,s._)("tbody",null,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(d.tempOrder.products,(e=>((0,s.wg)(),(0,s.iD)("tr",{key:e.id},[(0,s._)("td",null,(0,r.zw)(e.product.title),1),(0,s._)("td",null,[(0,s._)("div",ie,[(0,s.wy)((0,s._)("input",{type:"number",class:"form-control","aria-label":"buy number","onUpdate:modelValue":t=>e.qty=t,min:"1",disabled:""},null,8,de),[[l.nr,e.qty,void 0,{number:!0}]]),(0,s._)("div",ne," / "+(0,r.zw)(e.product.unit),1)])])])))),128))])])])]),(0,s._)("div",oe,[ce,(0,s._)("div",pe,[(0,s._)("p",null,(0,r.zw)(d.tempOrder.message),1)])]),(0,s._)("div",he,[(0,s._)("h5",ue," 總金額 "+(0,r.zw)(e.$filters.currency(d.tempOrder.total))+" NTD ",1)])])])])]),(0,s._)("div",ge,[me,(0,s._)("button",{type:"button",class:"btn btn-lg btn-danger w-50",onClick:t[6]||(t[6]=(...e)=>n.emitOrder&&n.emitOrder(...e))},"確認")])])])],512)}var be=a(1339),fe={props:{order:{type:Object,default(){return{}}}},data(){return{modal:{},tempOrder:{products:{},user:{}},isLoading:!1,is_paid:""}},watch:{order(){this.tempOrder=JSON.parse(JSON.stringify(this.order)),this.tempOrder.create_at=this.$filters.inputDateType(this.tempOrder.create_at)}},methods:{emitOrder(){const e=JSON.parse(JSON.stringify(this.tempOrder)),t=new Date(e.create_at).getTime();e.create_at=t/1e3,this.$emit("update-order",e)}},mixins:[be.Z],inject:["$httpMessageState"]},Oe=a(89);const we=(0,Oe.Z)(fe,[["render",_e]]);var ve=we,ye=a(4798),xe={components:{PaginationModel:D.Z,OrderModal:ve,DelModal:ye.Z},data(){return{orders:[],allOrders:[],filtedOrders:[],pageOrders:10,tempOrder:{},delOrder:{},isLoading:!1,pagination:{total_pages:"",current_page:1,has_pre:!1,has_next:!1},filter:"",searchText:"",specialText:0}},methods:{getTotalPages(e=1){this.isLoading=!0;const t="https://vue3-course-api.hexschool.io/api/cong-ren/admin/orders";this.$http.get(t).then((t=>{this.isLoading=!1,this.allOrders=[],this.getAllOrders(t.data.pagination.total_pages,e,1)})).catch((e=>{console.log("err",e)}))},async getAllOrders(e,t,a){this.isLoading=!0;const s=`https://vue3-course-api.hexschool.io/api/cong-ren/admin/orders?page=${a}`;await this.$http.get(s).then((s=>{this.allOrders=this.allOrders.concat(s.data.orders),s.data.pagination.current_page<e?this.getAllOrders(e,t,a+1):(this.isLoading=!1,this.filtOrders(t))}))},filtOrders(e=1){"id"===this.filter?this.filtedOrders=this.allOrders.filter((e=>e.id.match(this.searchText))):"name"===this.filter?this.filtedOrders=this.allOrders.filter((e=>e.user.name.match(this.searchText))):"tel"===this.filter?this.filtedOrders=this.allOrders.filter((e=>e.user.tel.match(this.searchText))):"email"===this.filter?this.filtedOrders=this.allOrders.filter((e=>e.user.email.match(this.searchText))):(this.filtedOrders=this.allOrders,this.searchText=""),"previous"===e?this.pagination.current_page-=1:"next"===e?this.pagination.current_page+=1:this.pagination.current_page=1===e?1:e,this.pagination.total_pages=Math.ceil(this.filtedOrders.length/this.pageOrders),1===this.pagination.current_page?(this.pagination.has_pre=!1,this.pagination.has_next=!0,1===this.pagination.total_pages&&(this.pagination.has_next=!1)):this.pagination.current_page===this.pagination.total_pages?(this.pagination.has_next=!1,this.pagination.has_pre=!0):(this.pagination.has_next=!0,this.pagination.has_pre=!0);const t=[],a=this.pagination.current_page;this.filtedOrders.forEach(((e,s)=>{s<=a*this.pageOrders-1&&s>=a*this.pageOrders-this.pageOrders&&t.push(e)})),this.filtedOrders=t},openModal(e){this.tempOrder=JSON.parse(JSON.stringify(e));const t=this.$refs.orderModal;t.showModal()},updateOrder(e){const t=this.$refs.orderModal,a=`https://vue3-course-api.hexschool.io/api/cong-ren/admin/order/${e.id}`;this.isLoading=!0,this.$http.put(a,{data:e}).then((e=>{this.isLoading=!1,e.data.success?(t.hideModal(),this.$httpMessageState("success","更新成功",e.data.message),this.allOrders=[],this.getAllOrders(this.pagination.total_pages,this.pagination.current_page,1)):this.$httpMessageState("warning","更新失敗","請重新檢查內容，並再次嘗試。")})).catch((()=>{this.isLoading=!1,this.$httpMessageState("danger","發生錯誤","請洽工程師。")}))},openDelModal(e){"all"===e?this.delOrder={title:"全部訂單"}:(this.delOrder=e,this.delOrder.title=`訂單${e.id}`);const t=this.$refs.delModal;t.showModal()},deleteOrder(){const e=this.$refs.delModal,t=`https://vue3-course-api.hexschool.io/api/cong-ren/admin/order/${this.delOrder.id}`;this.isLoading=!0,this.$http.delete(t).then((t=>{this.isLoading=!1,t.data.success?(this.getTotalPages(this.pagination.current_page),e.hideModal(),this.$httpMessageState("success","刪除訂單成功",t.data.message)):this.$httpMessageState("warning","刪除訂單失敗",t.data.message)})).catch((()=>{this.isLoading=!1,this.$httpMessageState("danger","發生錯誤","請洽工程師。")}))},deleteAll(){const e="https://vue3-course-api.hexschool.io/api/cong-ren/admin/orders/all",t=this.$refs.delModal;this.$http.delete(e).then((e=>{t.hideModal(),e.data.success?(this.$httpMessageState("success","成功清空訂單","讓我們重新開始吧 !"),this.getTotalPages(this.pagination.current_page)):this.$httpMessageState("warning","刪除全部訂單失敗",e.data.message)})).catch((()=>{t.hideModal(),this.$httpMessageState("danger","發生錯誤","請洽工程師。")}))},textCheck(){const e=this.searchText.replace(/[`~!#$%^&*()+=<>?:"{}|,./;'\\[\]·~！#￥%……&*（）——+={}|《》？：“”【】、；‘’，。、]/g,"");e!==this.searchText?this.specialText=1:(this.specialText=0,this.filtOrders(1))}},created(){this.getTotalPages(1)},inject:["emitter","$httpMessageState"]};const ke=(0,Oe.Z)(xe,[["render",$]]);var Me=ke}}]);
//# sourceMappingURL=469.780bc690.js.map